{% extends "base.html" %}
{% load nav %}
{% block siteSection %}{{ title }}{% endblock %}
{% block nav %}
   {{ block.super }}
{% endblock %}
   
{% block scripts %}
  {{ block.super }}
  <link rel="stylesheet" type="text/css" 
        href="{{ STATIC_URL }}style/jquery-ui.css" ></link>
  <script language="javascript" type="text/javascript"
	  src="{{ STATIC_URL }}jquery/ui/jquery-ui-1.8.12.custom.js"></script>
  <script language="javascript" type="text/javascript"
	  src="{{ STATIC_URL }}jquery/jquery-ui-timepicker-addon.js"></script>
  <script type="text/javascript">
function submitform(mode)
  {
	document.QueryForm["mode"].value = mode;
    document.QueryForm.submit();
  }
{% for f in datetimefields %}
  $('#id_{{f}}_lo').datetimepicker({addSliderAccess: false});
  $('#id_{{f}}_hi').datetimepicker({addSliderAccess: false});
{% endfor %}
$("#addform").click(function() {
	submitform('addform');
});
$("#query").click(function() {
	submitform('query');
});
$("#csv").click(function() {
	submitform('csv');
});
  </script>
  
  <script language="javascript" type="text/javascript"
	  src="{{ STATIC_URL }}external/js/jquery.flot.min.js"></script>
  <script language="javascript" type="text/javascript"
	  src="{{ STATIC_URL }}external/js/jquery.flot.threshold.min.js"></script>

{% if count %}
<script language="javascript" type="text/javascript">
  var results_plot = $.plot($("#results_plot"),
  [{ color:"blue", 
	  lines : { show : false }, points : { radius: 3, show : true, fill : true },
	data: {{ plotData.mean|safe }} }],
  {series: {shadowSize: 0, lines: {lineWidth:1}},
   grid: { hoverable: true, clickable: true },
   yaxis: { mode: {{ plotOpts.ymode|safe }}  },
   xaxis: { mode: {{ plotOpts.xmode|safe }} }
 });

</script>
{% endif %}

{% endblock %}


{% block contents %}						
<h2>{{ title }}</h2>  
{% for d in debug %}
<span>{{ d }}</span>
{% endfor %}
<form name='QueryForm' action="{% url xgds_data_plotQueryResults module model %}" method="post">
  <input type="hidden" name="mode" value="query">
    {{ formset.management_form }}
    {% for form in formset %}
		{% for field in form %}
        	{{ field.as_hidden }} 
		{% endfor %}
    {% endfor %}
        
<table>
{{ axesform.as_table }}
</table>

{% if count %}
	<input type="submit" value="Refresh Plot" id="plot" /> 
	<div id="results_plot" style="width:800px;height:450px"></div>
	<HR>
	{{ count }} records found 
{% elif formset.cleaned_data %}
	<HR>
	No records found 
{% endif %}
</form>

{% endblock %}

