{% extends "base.html" %}
{% load url from future %}
{% load nav %}
{% block siteSection %}{{ title }}{% endblock %}
{% block nav %}
   {{ block.super }}
{% endblock %}
   
{% block scripts %}
  {{ block.super }}
  <link rel="stylesheet" type="text/css" 
        href="{{ STATIC_URL }}style/jquery-ui.css" ></link>
  <script language="javascript" type="text/javascript"
	  src="{{ STATIC_URL }}jquery/ui/jquery-ui-1.8.12.custom.js"></script>
  <script language="javascript" type="text/javascript"
	  src="{{ STATIC_URL }}external/jquery/jquery-ui-timepicker-addon.js"></script>
  <script type="text/javascript">
  function submitform(mode)
  {
	document.QueryForm["mode"].value = mode;
    document.QueryForm.submit();
  }
{% for f in datetimefields %}
  $('#id_{{f}}_lo').datetimepicker({addSliderAccess: false});
  $('#id_{{f}}_hi').datetimepicker({addSliderAccess: false});
{% endfor %}
$("#addform").click(function() {
	submitform('addform');
});
$("#query").click(function() {
	submitform('query');
});
$("#csv").click(function() {
	submitform('csv');
});
$("#csvhard").click(function() {
	submitform('csvhard');
});
$("#plot").click(function() {
	document.QueryForm.action = "{% url 'xgds_data_searchPlotQueryResults' module model 0 10000 %}";
	document.QueryForm.submit();
});
$("#plothard").click(function() {
	document.QueryForm.action = "{% url 'xgds_data_searchPlotQueryResults' module model 'exact' 0 10000 %}";
	document.QueryForm.submit();
});
  </script>
  
  <script language="javascript" type="text/javascript"
	  src="{{ STATIC_URL }}external/js/jquery.flot.min.js"></script>
  <script language="javascript" type="text/javascript"
	  src="{{ STATIC_URL }}external/js/jquery.flot.threshold.min.js"></script>

{% endblock %}


{% block contents %}						
<h2>{{ title }}</h2>  
{% for d in debug %}
	<span>{{ d }}</span>
{% endfor %}
<form name='QueryForm' action="{% url 'xgds_data_searchChosenModel' module model %}" method="post">
  <input type="hidden" name="mode" value="query">
  
{% if axesform %}
    {% for field in axesform %}
          {{ field.as_hidden }} 
  {% endfor %}
{% endif %}

{{ formset.management_form }}
{% for form in formset %}
    <table>
	{{ form.as_table }}
    </table>
 
{% endfor %}

<input type="submit" value="Search" id="query" />
<input type="submit" value="Add Disjunction" id="addform" /> 
    
{% if count %}
	<HR>
	{% if count == exactCount %}
		{{ count }} matching records
	{% else %}
		About {{ count }} matching records
		{% if exactCount == 0 %}
			(no
		{% else %}
			({{ exactCount }}
		{% endif %}
		exact
		{% if exactCount == 1 %}
			match)
		{% else %}
			matches)
		{% endif %}
	{% endif %}
	<BR />
	{% if count > 0 %}
    	<input type="submit" value="Download All Matches" id="csv" />
    {% else %}
    	<input type="submit" value="Download All Matches" id="csv" disabled />
    {% endif %}
    {% if count != exactCount %}
	    {% if exactCount > 0 %}
	    	<input type="submit" value="Download Exact Matches" id="csvhard" />
	    {% else %}
	    	<input type="submit" value="Download Exact Matches" id="csvhard" disabled />
	    {% endif %}
    {% endif %}
    {% if axesform %}
	    {% if count > 10000 %}
	    	<input type="submit" value="Plot Matches" id="plot" title="Plot limited to 10000 records" /> 
	    {% elif count > 0 %}
	    	<input type="submit" value="Plot Matches" id="plot"/> 
	    {% else %}
	    	<input type="submit" value="Plot Matches" id="plot" disabled /> 
	    {% endif %}
	    {% if count != exactCount %}
		    {% if exactCount > 10000 %}
		    	<input type="submit" value="Plot Exact Matches" id="plothard" title="Plot limited to 10000 records" /> 
		    {% elif exactCount > 0 %}
		    	<input type="submit" value="Plot Exact Matches" id="plothard"/> 
		    {% else %}
		    	<input type="submit" value="Plot Exact Matches" id="plothard" disabled />
		    {% endif %}
	    {% endif %}
    {% endif %}

{% elif formset.cleaned_data %}
	<HR>
	No records match 
{% endif %}
</form>

{% endblock %}

